<!DOCTYPE html>
<html>
    <head>
	    <title></title>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </head>
    <body>
        <h1>Shopping Cart</h1>
        
        <div>
            <ul>
                <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
                <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.00">Frisbee $5.22</a></li>
            </ul>
            <button id="clear-cart">Clear Cart</button>
        </div>

        <div>
            <ul id="show-cart">
                <!-- Everytime we click an item link above, when we add item to cart, it will appear on the list so we
                we will use the listCart function to regnerate the html in this <div>. Anything inside this tag(the inner html of the "show-cart") gets overwriten when we call .html(output in this example) --> 
            </ul>
            <div>You have <span id="count-cart">X</span> items in your cart</div>
            <div>Total Cart: $<span id="total-cart"></span></div> <!-- We use span so that Total Cart: $ does not get overwritten by .html. -->
        </div>



        <script>

            
           
            $(".add-to-cart").click(function(event){
                event.preventDefault(); // Prevents links from refreshing the page. Changes right there on the page. 
                var name = $(this).attr("data-name"); // keyword "this" represents the link you click on from above.
                var price = Number($(this).attr("data-price")); // coverts string to number "Number"
                
                practiceCart.addItemToCart(name, price, 1);
                displayCart(); 
            });

            
            $("#clear-cart").click(function(event){
                practiceCart.clearCart();
                displayCart(); 
            }); 

            
            function displayCart() { // Displays the cart in the <!-- --> above. 
                var cartArray = practiceCart.listCart();
                var output = ""; 
                for (var i in cartArray) {
                    output += "<li>"+cartArray[i].name
                    +" <input class='item-count' type='number' data-name='"
                    +cartArray[i].name
                    +"' value='"+cartArray[i].count+"' >"
                    +" x "+cartArray[i].price
                    +" = "+cartArray[i].total
                    +" <button class='plus-item' data-name='"
                    +cartArray[i].name+"'>+</button>"
                    +" <button class='subtract-item' data-name='"
                    +cartArray[i].name+"'>-</button>"
                    +" <button class='delete-item' data-name='"
                    +cartArray[i].name+"'>X</button>" // Does not exist yet until after displayCart is called on
                    +"</li>"; // += means append to this. Add more items to this everytime we loop. 
                }
                $("#show-cart").html(output); // Shows us our listed cart in out html page. the .html allows us to write, text into a tag like in between the show-cart ul tag.
                $("#count-cart").html(practiceCart.countCart()); 
                $("#total-cart").html(practiceCart.totalCart());
            }

            
            $("#show-cart").on("click", ".delete-item", function(event){ // #show-cart is parent element of delete button class. so the on method is when a click event occurs on show cart, we see if that click occurs on the .delete-item class. If it does occur we execute this function. Otherwise, it is not executed. 
                var name = $(this).attr("data-name"); // this refers to the button you click on which occurs on one of the the items with .delete-item. 
                practiceCart.removeItemFromCartAll(name); 
                displayCart(); 
            }); 

            $("#show-cart").on("click", ".subtract-item", function(event){
                var name = $(this).attr("data-name"); 
                practiceCart.removeItemFromCart(name); 
                displayCart(); 
            });

            $("#show-cart").on("click", ".plus-item", function(event){
                var name = $(this).attr("data-name"); 
                practiceCart.addItemToCart(name, 0, 1); // Can't use "this" because jqeury stuff is outside of the shopping cart object. They just call on the methods inside the shopping cart object. So we have to use the name practiceCart. 
                displayCart(); 
            });

            $("#show-cart").on("change", ".item-count", function(event) { // will change value of output when activated. 
                var name = $(this).attr("data-name"); 
                var count = Number($(this).val()); // We can get the value from the input field with val. "this" refers to item count(input field). Also number coverts string to number. 
                practiceCart.setCountForItem(name, count); // name of item we want to set the count for, and how many of that item we want to set. 
                displayCart(); // When we add this, the input field updates along with the price for that particular item.    
            }); 
           
            


            // Functions below. JQuery above are thing outside the practiceCart object. Everything below belongs to the practiceCart object. 

            var practiceCart = {}; // To avoid scoping problems we can put everything into one variable as long as that variable is unique. So we have a namespace in this case practiceCart that is an object where we can add functions(as properties) aka methods and variables. So we put all our functions and variables in this namespace(one main variable). We are converting out shopping cart into an object. 

            
            practiceCart.cart = []; // This variable is attatched to practiceCart object. In order for the cart to work we need to do this.cart for everywhere cart appears below. 
            
            
            practiceCart.Item = function(name, price, count) {
                this.name = name;
                this.price = price;
                this.count = count; 
            }; 

            practiceCart.addItemToCart = function(name, price, count) { // Anytime you are in a method(function) that belongs to an object, you can refer to that method as "this"
                for (var i in this.cart) {
                    if (this.cart[i].name === name) { // .name if from Item in cart and === name if from addItemToCart(name)
                        this.cart[i].count += count; // Add count to whatever the value of count prop is. 
                        this.saveCart(); //Need to add this here otherwise return statmenet will skip saved info. 
                        return; // This will end the function 
                    }
                }
                var item = new this.Item(name, price, count); //Executed only if we do not already find the item name in the cart
                this.cart.push(item);
                this.saveCart();  // practiceCart owns addItemToCart and saveCart. // this.saveCart inside the method addItemToCart means it belongs to the owner of this method. The owner is practiceCart. 
            };


            practiceCart.setCountForItem = function(name, count) { // **** Review this Checkpoint 27 countInput ****
                for (var i in this.cart) {
                    if (this.cart[i].name === name) {
                        this.cart[i].count = count; // Count is string. 
                        break; 
                    }
                }
                this.saveCart(); 
            };
           
            
            practiceCart.removeItemFromCart = function(name) { // Removes one item by looking up the name
                for (var i in this.cart) {
                    if (this.cart[i].name === name) {
                        this.cart[i].count--; // cart[i].count = cart[i].count - 1; or cart[i].count -= 1; (same thing)
                        if (this.cart[i].count === 0) {
                            this.cart.splice(i, 1); // If count is 0 it removes item from cart completely. or you can put removeItemFromCartAll(); instead of using splice in this case. 
                        }
                        break; 
                    }
                }
                this.saveCart(); // Use "this" since it is a method inside the practiceCart object. the object is our self. 
            };
            

            practiceCart.removeItemFromCartAll = function(name) { // Removes all of a particular item using name.
                for (var i in this.cart) {
                    if (this.cart[i].name === name) {
                        this.cart.splice(i, 1); 
                        break; 
                    }
                }
                this.saveCart(); 
            };


            practiceCart.clearCart = function() {  // Removes everything
                this.cart = [];
                this.saveCart(); 
            };


            practiceCart.countCart = function() {  // Count number of items in the cart (returns total count)
                var totalCount = 0;
                for (var i in this.cart) {
                    totalCount += this.cart[i].count
                }
                return totalCount; 
            }; 

           

            practiceCart.totalCart = function() {  // Total price of all the items (returns total cost)
                var totalCost = 0; 
                for (var i in this.cart) {
                    totalCost += this.cart[i].price * this.cart[i].count; // Fixed mistake. // totalCost is a variable but it contains a number so we can add methods to it. 
                }
                return totalCost.toFixed(2); // toFixed method converts our number to a string and rounds it to a fixed number of decimal spaces. 
            }; 


            practiceCart.listCart = function() {  // Returns an array of all items (displays it). This helps with debugging
                var cartCopy = []; // this does not get keyword "this" since they have keyword "var" in front of it. 
                for (var i in this.cart) { // Looping through each item in the cart
                    var item = this.cart[i]; 
                    var itemCopy = {}; //This is what we pass back to other functions. 
                    for (var p in item) { // Looping through each property of the item and make that a property in copy and give it the same value. This gets our 3 properties name, price, and count of the original array. 
                        itemCopy[p] = item[p]; 
                    }
                    itemCopy.total = (item.price * item.count).toFixed(2); // We add this 4th property in this checkpoint. 
                    cartCopy.push(itemCopy); // Adding the itemcopy to the cartcopy
                }
                 
                return cartCopy; 
            };


            practiceCart.saveCart = function() {
                localStorage.setItem("shoppingCart", JSON.stringify(this.cart)); // parameters represent name and value; JSON is used to convert arrays and objects into a string. LocalStorage needs JSON since it can only store values as strings or numbers. 
            };


            practiceCart.loadCart = function() {
                this.cart = JSON.parse(localStorage.getItem("shoppingCart")); // We want to covert that sting we get back from the JSON object, into an array or object. At the moment variable cart = is global since we have not said where cart belongs to since it is not attatched to practiceCart yet. We need to fix this. *** Important *** So we fix this by putting keyword "this"
            }; 

            practiceCart.loadCart(); // without this our cart will have zero items in it
            displayCart(); // If I want to display my cart initially when the page is loaded you have to make sure you call the display cart function after you have loaded the cart from local storage. *** Important ***

            console.log("Shopping Cart: cart");
            console.log(practiceCart.cart); // This will be empty
            console.log("Global Cart");
            console.log(cart); // This will show items in it. We don't want this. We want it to belong to practiceCart.cart. When things are not appearing in it, we will know it is not global anymore. 
           
        </script>
    </body>
</html>