<!DOCTYPE html>
<html>
    <head>
	    <title></title>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </head>
    <body>
        <h1>Shopping Cart</h1>
        
        <div>
            <ul>
                <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
                <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.00">Frisbee $5.22</a></li>
            </ul>
            <button id="clear-cart">Clear Cart</button>
        </div>

        <div>
            <ul id="show-cart">
                <!-- Everytime we click an item link above, when we add item to cart, it will appear on the list so we
                we will use the listCart function to regnerate the html in this <div>. Anything inside this tag(the inner html of the "show-cart") gets overwriten when we call .html(output in this example) --> 
            </ul>
            <div>Total Cart: $<span id="total-cart"></span></div> <!-- We use span so that Total Cart: $ does not get overwritten by .html. -->
        </div>



        <script>

            
           
            $(".add-to-cart").click(function(event){
                event.preventDefault(); // Prevents links from refreshing the page. Changes right there on the page. 
                var name = $(this).attr("data-name"); // keyword "this" represents the link you click on from above.
                var price = Number($(this).attr("data-price")); // coverts string to number "Number"
                
                practiceCart.addItemToCart(name, price, 1);
                displayCart(); 
            });

            
            $("#clear-cart").click(function(event){
                clearCart();
                displayCart(); 
            }); 

            
            function displayCart() { // Displays the cart in the <!-- --> above. 
                var cartArray = practiceCart.listCart();
                var output = ""; 
                for (var i in cartArray) {
                    output += "<li>"+cartArray[i].name
                    +" "+cartArray[i].count
                    +" x "+cartArray[i].price
                    +" = "+cartArray[i].total
                    +" <button class='plus-item' data-name='"
                    +cartArray[i].name+"'>+</button>"
                    +" <button class='subtract-item' data-name='"
                    +cartArray[i].name+"'>-</button>"
                    +" <button class='delete-item' data-name='"
                    +cartArray[i].name+"'>X</button>" // Does not exist yet until after displayCart is called on
                    +"</li>"; // += means append to this. Add more items to this everytime we loop. 
                }
                $("#show-cart").html(output); // Shows us our listed cart in out html page. the .html allows us to write, text into a tag like in between the show-cart ul tag.
                $("#total-cart").html(practiceCart.totalCart());
            }

            
            $("#show-cart").on("click", ".delete-item", function(event){ // #show-cart is parent element of delete button class. so the on method is when a click event occurs on show cart, we see if that click occurs on the .delete-item class. If it does occur we execute this function. Otherwise, it is not executed. 
                var name = $(this).attr("data-name"); // this refers to the button you click on which occurs on one of the the items with .delete-item. 
                removeItemFromCartAll(name); 
                displayCart(); 
            }); 

            $("#show-cart").on("click", ".subtract-item", function(event){
                var name = $(this).attr("data-name"); 
                removeItemFromCart(name); 
                displayCart(); 
            });

            $("#show-cart").on("click", ".plus-item", function(event){
                var name = $(this).attr("data-name"); 
                addItemToCart(name, 0, 1); 
                displayCart(); 
            });
           
            


            // Functions below. JQuery above. 

            var practiceCart = {}; // To avoid scoping problems we can put everything into one variable as long as that variable is unique. So we have a namespace in this case practiceCart that is an object where we can add functions(as properties) aka methods and variables. So we put all our functions and variables in this namespace(one main variable).

            
            practiceCart.cart = []; 
            
            
            practiceCart.Item = function(name, price, count) {
                this.name = name;
                this.price = price;
                this.count = count; 
            }; 

            practiceCart.addItemToCart = function(name, price, count) { // Anytime you are in a method(function) that belongs to an object, you can refer to that method as "this"
                for (var i in cart) {
                    if (cart[i].name === name) { // .name if from Item in cart and === name if from addItemToCart(name)
                        cart[i].count += count; // Add count to whatever the value of count prop is. 
                        this.saveCart(); //Need to add this here otherwise return statmenet will skip saved info. 
                        return; // This will end the function 
                    }
                }
                var item = new this.Item(name, price, count); //Executed only if we do not already find the item name in the cart
                cart.push(item);
                this.saveCart();  // practiceCart owns addItemToCart and saveCart. // this.saveCart inside the method addItemToCart means it belongs to the owner of this method. The owner is practiceCart. 
            };
           
            
            practiceCart.removeItemFromCart = function(name) { // Removes one item by looking up the name
                for (var i in cart) {
                    if (cart[i].name === name) {
                        cart[i].count--; // cart[i].count = cart[i].count - 1; or cart[i].count -= 1; (same thing)
                        if (cart[i].count === 0) {
                            cart.splice(i, 1); // If count is 0 it removes item from cart completely. or you can put removeItemFromCartAll(); instead of using splice in this case. 
                        }
                        break; 
                    }
                }
                saveCart(); 
            };
            

            practiceCart.removeItemFromCartAll = function(name) { // Removes all of a particular item using name.
                for (var i in cart) {
                    if (cart[i].name === name) {
                        cart.splice(i, 1); 
                        break; 
                    }
                }
                saveCart(); 
            };


            practiceCart.clearCart = function() {  // Removes everything
                cart = [];
                saveCart(); 
            };


            practiceCart.countCart = function() {  // Count number of items in the cart (returns total count)
                var totalCount = 0;
                for (var i in cart) {
                    totalCount += cart[i].count
                }
                return totalCount; 
            }; 

           

            practiceCart.totalCart = function() {  // Total price of all the items (returns total cost)
                var totalCost = 0; 
                for (var i in cart) {
                    totalCost += cart[i].price * cart[i].count; // Fixed mistake. // totalCost is a variable but it contains a number so we can add methods to it. 
                }
                return totalCost.toFixed(2); // toFixed method converts our number to a string and rounds it to a fixed number of decimal spaces. 
            }; 


            practiceCart.listCart = function() {  // Returns an array of all items (displays it). This helps with debugging
                var cartCopy = []; 
                for (var i in cart) { // Looping through each item in the cart
                    var item = cart[i]; 
                    var itemCopy = {}; //This is what we pass back to other functions. 
                    for (var p in item) { // Looping through each property of the item and make that a property in copy and give it the same value. This gets our 3 properties name, price, and count of the original array. 
                        itemCopy[p] = item[p]; 
                    }
                    itemCopy.total = (item.price * item.count).toFixed(2); // We add this 4th property in this checkpoint. 
                    cartCopy.push(itemCopy); // Adding the itemcopy to the cartcopy
                }
                 
                return cartCopy; 
            };


            practiceCart.saveCart = function() {
                localStorage.setItem("shoppingCart", JSON.stringify(cart)); // parameters represent name and value; JSON is used to convert arrays and objects into a string. LocalStorage needs JSON since it can only store values as strings or numbers. 
            };


            practiceCart.loadCart = function() {
                cart = JSON.parse(localStorage.getItem("shoppingCart")); // We want to covert that sting we get back from the JSON object, into an array or object 
            }; 

            practiceCart.loadCart(); // without this our cart will have zero items in it
            displayCart(); // If I want to display my cart initially when the page is loaded you have to make sure you call the display cart function after you have loaded the cart from local storage. *** Important ***

           
        </script>
    </body>
</html>